<div id="solution-latex" class="question-solution">
  <div class="solution-title"></div>
  <div class="solution-text"></div>
</div>


// This is a manifest file that'll be compiled into application.js, which will include all the files
// listed below.
//
// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,
// or any plugin's vendor/assets/javascripts directory can be referenced here using a relative path.
//
// It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the
// compiled file. JavaScript code in this file should be added after the last require_* statement.
//
// Read Sprockets README (https://github.com/rails/sprockets#sprockets-directives) for details
// about supported directives.
//
//= require jquery
//= require jquery.turbolinks
//= require jquery_ujs
//= require turbolinks
//= require_tree .

function showSolutions() {
  $(document).ready(function() {
    $('.solution-link').show();
    $('.next-question').hide();


    var submitSolution = function(event){
      event.preventDefault();
      var submitSolutionForm = $(this).parent();
      submitSolutionForm.siblings('.next-question').show();
      var postAddress = submitSolutionForm.attr('action');
      var choice = submitSolutionForm.find('input:checked[name="choice"]').val();
      var question_id = submitSolutionForm.find('input[name="question_id"]').val();
      var lesson_id = submitSolutionForm.find('input[name="lesson_id"]').val();
      var authenticity_token = submitSolutionForm.find('input[name="authenticity_token"]').val();
      // var solutionDiv = $(this).siblings("#solution-latex");
      var solutionTitle = $(this).siblings(".solution-title");
      var solutionText = $(this).siblings(".solution-text");
      var correctDiv = $(this).siblings("#correct");
      // var currentLessonExp = $(this).parent().parent().prev().prev(".lesson-headings").children(".lesson-progress-exp").children(".current-lesson-exp").css({"color": "red", "border": "2px solid red"});
      var lessonExp = submitSolutionForm.parent().prev().prev(".lesson-headings").children(".lesson-progress-exp").children(".current-lesson-exp");
      var topicExp = submitSolutionForm.parent().parent().prev().children(".topic-headings").children(".progress-exp").children(".topic-exp");
      var topicNextLevelExp = submitSolutionForm.parent().parent().prev().children(".topic-headings").children(".progress-exp").children(".next-level-exp");
      var topicNextLevel = submitSolutionForm.parent().parent().prev().children(".topic-headings").children(".progress-exp").children(".next-level");

      $.post(postAddress, { 'choice': choice, 'question_id': question_id, 'lesson_id': lesson_id, 'authenticity_token': authenticity_token }, function(response){
        // solutionDiv.text(response.question_solution);
        solutionTitle.text("Solution");
        solutionText.text(response.question_solution);
        correctDiv.text(response.message);
        lessonExp.text(response.lesson_exp);
        topicExp.text(response.topic_exp);
        topicNextLevelExp.text(response.topic_next_level_exp);
        topicNextLevel.text(response.topic_next_level);

        if (response.choice == "true") {
          correctDiv.css("color", "green");
        } else {
          correctDiv.css("color", "red");
        };
        MathJax.Hub.Typeset();
      });
    };




    $('.solution-link').on('click',submitSolution);





    $('.remove-question').on('click', function(event){
      event.preventDefault();
      var postAddress = $(this)[0].href;
      var authenticity_token = $('meta[name="csrf-token"]').attr("content");
      var question_id = $(this).parent().data("questionid");
      var lesson_id = $(this).parent().data("lessonid");
      var crudDiv = $(this).parent();
      $.post(postAddress, {'question_id': question_id, 'lesson_id': lesson_id, 'authenticity_token': authenticity_token}, function(response){
        crudDiv.siblings(".question-" + question_id).remove();
        crudDiv.remove();
        MathJax.Hub.Typeset();
      });
    });




    $('.next-question').on('click', function(event){
      event.preventDefault();
        var nextQuestionLink = $(this);
        var nextQuestionDiv = $(this).parent('div');
        var nextQuestionForm = $(this).siblings('form');

      $.get(this.href, function(response){

        nextQuestionForm.siblings('.question-header').children('.question-exp').text(response.question.experience);
        nextQuestionForm.siblings('.question-header').children('.streak-mtp').text(response.lesson_bonus_exp);

        nextQuestionDiv.children().eq(1).text(response.question.question_text);
        nextQuestionForm.children().eq(2).val(response.question.id);
        var utfInput = nextQuestionForm.children().eq(0);
        var tokenInput = nextQuestionForm.children().eq(1);
        var questionIdInput = nextQuestionForm.children().eq(2);
        var lessonIdInput = nextQuestionForm.children().eq(3);
        // var solutionLatexDiv = nextQuestionForm.children().last();
        var solutionTitle = nextQuestionForm.children('.solution-title');
        var solutionText = nextQuestionForm.children('.solution-text');
        solutionTitle.text("");
        solutionText.text("");

        nextQuestionForm.children().last().remove();
        nextQuestionForm.children().last().remove();
        var correctDiv = nextQuestionForm.children().last();
        correctDiv.text('');

        nextQuestionForm.children().last().remove();
        var submitInput = nextQuestionForm.children().last();
        nextQuestionForm.children().last().remove();

        nextQuestionForm.empty();

        nextQuestionForm.append(utfInput);
        nextQuestionForm.append(tokenInput);
        nextQuestionForm.append(questionIdInput);
        nextQuestionForm.append(lessonIdInput);
        var choices = response.choices;
        for (var i = 0, len = choices.length; i < len; i++) {
          nextQuestionForm.append("<input class='question-choice' type='radio' id='choice-"
            + choices[i].id +"' " + "name='choice' value=" + choices[i].correct
            +  ">" + '<span style="padding-left:10px;">' + choices[i].content + '</span>' + "<br>");
        };
        nextQuestionForm.append(submitInput);
        nextQuestionForm.append(correctDiv);
        // nextQuestionForm.append(solutionLatexDiv);
        nextQuestionForm.append(solutionTitle);
        nextQuestionForm.append(solutionText);

        nextQuestionLink.hide();
        nextQuestionForm.children('.solution-link').show();
        MathJax.Hub.Typeset();

        $('.solution-link').on('click',submitSolution);

      });
    });



    $('.chapter-collapsable').on('click', function(event){
      event.preventDefault();
      if ($(this).next().is(':visible')){
        $(this).next().hide();
      } else {
        $(this).next().show();
      };
      $(".topic-headings").css("margin-top","5px");
    });





  });
  MathJax.Hub.Typeset();
};



<div class='lesson-progress-exp'>
  Exp: &emsp; <span class="current-lesson-exp" ><%= StudentLessonExp.current_exp(current_user,lesson)%></span>/<%= lesson.pass_experience %> &emsp; Pass
</div>













<% if current_user == nil %>
      <% if lesson.questions.any? %>
          <% rand_q = lesson.questions.first %>
          <div class="question-container">
            <p><strong>Question</strong></p>
            <p><%= rand_q.question_text %></p>
              <%= form_for rand_q, url: { controller: :questions, action: 'check_answer' }, method: :post do |f| %>
                  <input type='hidden' name='question_id' value=<%= rand_q.id %>>
                  <% rand_q.choices.each do |c| %>
                    <input type='radio' id="choice-<%= c.id %>" name='choice' value=<%= c.correct %>>
                    <%= c.content %>
                    <br>
                  <% end %>
                  <%= f.submit "Submit answer", class: 'solution-link' %>
                  <div id="correct"></div>
                  <div id="solution-latex"></div>
              <% end %>
          </div>
      <% else %>
          <div class="question-container">
            <div id="solution-latex">
                No questions have been added to this lesson yet.
            </div>
          </div>
      <% end %>
<% elsif (current_user.admin? || current_user.super_admin?) %>
    <div class="question-container">
        <%question_count = 1%>
        <% lesson.questions.each do |question| %>
          <div class="question-<%= question.id %>">
            <p><strong>Question <%= question_count%></strong></p>
            <p><%= question.question_text %></p>
            <p><strong>Solution <%= question_count%></strong></p>
            <p><%= question.solution %></p>
            <%question_count = question_count + 1%>
            <p>
              <ul>
              <% question.choices.each do |choice| %>
                <li>
                  &emsp; <%= choice.content %>
                  &emsp; <%= choice.correct %>
                </li>
              <% end %>
              </ul>
            </p>
          </div>
          <div class='crud-links' data-questionid = '<%= question.id %>' data-lessonid = '<%= lesson.id %>'>
            &emsp;
            <%= link_to "Edit question", edit_question_path(question) %>
            &emsp;
            <%= link_to "Remove question", lesson_remove_question_path(lesson), class:"remove-question" %>
            &emsp;
            <%= link_to "Add a choice to question", new_question_choice_path(question) %>
          </div>
        <% end %>
    </div>
<% elsif current_user.student? %>
  <% if lesson.questions.any? %>
      <% if current_user && current_user.has_current_question?(lesson)%>
        <% rand_q = current_user.fetch_current_question(lesson)  %>
      <% else %>
        <% rand_q = lesson.random_question(current_user) %>
        <% if !!rand_q %>
          <% CurrentQuestion.create(user_id: current_user.id, lesson_id: lesson.id, question_id: rand_q.id)%>
        <% end %>
      <% end %>
        <% if !!rand_q %>
              <div class="question-container">
                <p class='question-header'>
                  Question &emsp; (<span class="question-exp"><%= rand_q.experience %></span> xp +
                  <span class='streak-mtp'><%= (rand_q.experience * StudentLessonExp.get_streak_bonus(current_user, lesson)).to_i %></span><span class='streak-mtp-text'> xp streak bonus </span>)
                </p>
                <p class='question-text'><%= rand_q.question_text %></p>
                <%= form_for rand_q, url: { controller: :questions, action: 'check_answer' }, method: :post do |f| %>
                    <input type='hidden' name='question_id' value=<%= rand_q.id %>>
                    <input type='hidden' name='lesson_id' value=<%= lesson.id %>>

                    <% choices = rand_q.choices.shuffle %>
                    <% choices.each do |c| %>
                      <input class="question-choice" type='radio' id="choice-<%= c.id %>" name='choice' value=<%= c.correct %>>
                      &emsp;<%= c.content %>
                      <br>
                    <% end %>
                    <%= f.submit "Submit answer", class: 'solution-link' %>
                    <div id="correct" class="question-result"></div>
                    <div class="solution-title"></div>
                    <div class="solution-text"></div>
                <% end %>
                <%= link_to "Next question", next_question_lesson_path(lesson),class: "next-question" %>
              </div>
        <% else %>
              <div class="question-container">
                <div class="request-more-questions">
                  Well done! You have attempted all the questions available for this lesson, contact us to ask for more!
                </div>
              </div>
        <% end %>


  <% else %>
            <div class="question-container">
              <div id="solution-latex">
                  No questions have been added to this lesson yet.
              </div>
            </div>
  <% end %>
<% end %>












TEMP TEMP TEMP




<% if !!current_user && current_user.student? %>
  <% if topic.questions.any? %>
      <% if current_user && current_user.has_current_topic_question?(topic)%>
        <% rand_q = current_user.fetch_current_topic_question(topic)  %>
      <% else %>
        <% rand_q = topic.random_question(current_user) %>
        <% if !!rand_q %>
          <% CurrentTopicQuestion.create(user_id: current_user.id, topic_id: topic.id, question_id: rand_q.id)%>
        <% end %>
      <% end %>
        <% if !!rand_q %>
              <div class="question-container">
                <p class='question-header'>
                  Question &emsp; (<span class="question-exp"><%= rand_q.experience %></span> xp +
                  <span class='streak-mtp'>0</span><span class='streak-mtp-text'> xp streak bonus </span>)
                </p>
                <p class='question-text'><%= rand_q.question_text %></p>
                <%= form_for rand_q, url: { controller: :questions, action: 'check_topic_answer' }, method: :post do |f| %>
                    <input type='hidden' name='question_id' value=<%= rand_q.id %>>
                    <input type='hidden' name='topic_id' value=<%= topic.id %>>

                    <% choices = rand_q.choices.shuffle %>
                    <% choices.each do |c| %>
                      <input class="question-choice" type='radio' id="choice-<%= c.id %>" name='choice' value=<%= c.correct %>>
                      &emsp;<%= c.content %>
                      <br>
                    <% end %>
                    <%= f.submit "Submit answer", class: 'solution-link' %>
                    <div id="correct" class="question-result"></div>
                    <div class="solution-title"></div>
                    <div class="solution-text"></div>
                <% end %>
                <%= link_to "Next question", next_question_topic_path(topic),class: "next-question" %>
              </div>
        <% else %>
              <div class="question-container">
                <div class="request-more-questions">
                  Well done! You have attempted all the questions available for this lesson, contact us to ask for more!
                </div>
              </div>
        <% end %>


  <% else %>
            <div class="question-container">
              <div id="solution-latex">
                  No questions have been added to this topic yet.
              </div>
            </div>
  <% end %>
<% end %>











// <i class="fa fa-arrow-up" aria-hidden="true"></i>
